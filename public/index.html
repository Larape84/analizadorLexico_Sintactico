<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Analizador Lexico y Sintactico</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>

    <Style type = "text/css">

.my-custom-scrollbar  {
position: relative;
height: 300px;
overflow: auto;
}
.table-wrapper-scroll-y {
display: block;
}

</Style>

</head>
<body>
    <div class="container" style="max-width: 800px;">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <div align="center" ><img src="./img/logo.png" width="158" height="160" ></div>
        <div class="text-center" style="margin: 20px 0px 20px 0px;">
            <a href="" target="_blank">Analizador Lexico y Sintactico</a><br>
            <span class="text-secondary">sintaxis para las variables GRANT y REVOKE SQL</span>
            <br>
            <span class="text-secondary col-mb-6">Introduzca el codigo a analizar</span>
            <textarea class="form-control" id="inputcodigo" name="inputcodigo" rows="5" type="text"></textarea>
            </div>

            <button type="button" class="btn btn-primary" onclick="analizar()">Analizar</button>
            <button type="button" class="btn btn-danger" onclick="borrar()">Borrar</button>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
              Ver ejemplos de Sintaxis
            </button>

           

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Sintasis GRANT y REVOKE SQL</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>instrucciones SQl para las sentencias GRANT y REVOKE</p> 




      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" onclick="insertar()">Insertar Ejemplos</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>

      </div>
    </div>
  </div>
</div>

            <br><br>


            <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </symbol>
                <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                </symbol>
                <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                </symbol>
              </svg>
              
        
      
             
        
              <div class="alert alert-success d-flex align-items-center" role="alert" id="compilaBien" name="compilaBien" style="display: none;">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                <div>
                  An example success alert with an icon
                </div>
              </div>
        
        
              <div class="alert alert-warning d-flex align-items-center" role="alert" id="compilaconError" name="compilaconError" style="display: none;">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Warning:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                <div>
                  An example warning alert with an icon
                </div>
              </div>
        
        
        
              <div class="alert alert-danger d-flex align-items-center" id="noCompila" role="alert" id="NoCompila" name="NoCompila" style="display: none;">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                <div>
                  An example danger alert with an icon
                </div>
              </div>

            

<div  id="ocultarLexico" name="ocultarLexico" style="display: none;">


    



      












            <div class="container_lexico">
                <h4>Analizador Lexico</h4>
                <div id="aLexico" class="table-wrapper-scroll-y my-custom-scrollbar table-responsive" >
                  <table class="table table-bordered table-striped table align-middle">
                    <thead class="thead-dark" style="position: sticky;top: 0" >
                      <tr>
                        <th class="h6" scope="col">nro</th>
                        <th class="h6" scope="col">nombre</th>
                        <th class="h6"scope="col">tipo</th>
                        <th class="h6"scope="col">codigo</th>
                      </tr>
                    </thead>
                    <tbody id="cuerpoTabla"></tbody>
                  </table>
                </div>
              </div>
            </div>




<script type="text/javascript">





function insertar(){

document.querySelectorAll("table tbody tr").forEach(function(e){e.remove()})
document.getElementById("inputcodigo").value="REVOKE READ_WRITE ON MiEsquema1;\nGRANT EXECUTE ON dbo.uspGetBillOfMaterials TO newrole;\nGRANT SELECT ON OBJECT :: eddas ( exel ) TO leonardo;\nGRANT UPDATE ON TABLE TABLA1 TO USER1 , USER2 , USER3 , USER5 WITH GRANT OPTION;\nGRANT INSERT ON ORDER_BACKLOG TO PUBLIC WITH GRANT OPTION;\nGRANT ALL PRIVILEGES TO TABLA WITH GRANT OPTION;\nGRANT DELETE ON TABLE TABLA1 TO USER1;\nGRANT SELECT ON TABLE Q.PLANTILLA TO PUBLIC AT ALL LOCATIONS;\nGRANT READ , WRITE ON VARIABLE MYSCHEMA.MYJOB_PRINTER TO ZUBIRI;\nREVOKE SELECT ON USUARIOS FROM ASMITH;\nREVOKE SELECT ON TABLE SMITH.TABLEA FROM BAKER BY ALL;\nREVOKE ALL PRIVILEGES ON USUARIOS FROM ASMITH;\nREVOKE ALL PRIVILEGES ON USUARIOS FROM PUBLIC;\nREVOKE SELECT ON TABLE EMPLOYEE FROM ENGLES;\nREVOKE UPDATE ON EMPLOYEE FROM PUBLIC;\nREVOKE ALL ON EMPLOYEE FROM USER PELLOW , USER MLI , USER LEO , GROUP PLANNERS;\nREVOKE SELECT ON CORPDATA.EMPLOYEE FROM JOHN;\nREVOKE SELECT ON CORPDATA.EMPLOYEE FROM USER JOHN;\nREVOKE SELECT ON CORPDATA.EMPLOYEE FROM JOHN;\nREVOKE SELECT ON CORPDATA.EMPLOYEE FROM GROUP JOHN;\nREVOKE INDEX ON ORAREM1 FROM USER SHAWN";
$('#ocultarLexico').css('display', 'none');
$('#ocularSintactico').css('display', 'none');
document.querySelector("#staticBackdrop > div > div > div.modal-footer > button.btn.btn-secondary").click();
}

 
let lexemas;
lexemas=[

  {
      "nombre": "REVOKE",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "ROLE",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "SCHEMA",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "GRANT",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "SELECT",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "TO",
      "tipo": "reservada",
      "codigo":"100"
  },

  {
    "nombre": "ON",
    "tipo": "reservada",
    "codigo":"100"
},
{
    "nombre": "::",
    "tipo": "reservada",
    "codigo":"100"
},
  
  {
      "nombre": "VAR",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "CONST",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "LET",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "SWITCH",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "CASE",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "IF",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "ELSE",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "FOR",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "WHILE",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "PARSEFLOAT",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "BREAK",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "TEXTCONTENT",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "INNERHTML",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "DOCUMENT",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "getElementById",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "RETURN",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "CONTINUE",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "TRY",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "CATCH",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "CONSOLE",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": "LOG",
      "tipo": "reservada",
      "codigo":"100"
  },
  {
      "nombre": 0,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 1,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 2,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 3,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 4,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 5,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 6,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 7,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 8,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": 9,
      "tipo": "numero",
      "codigo":"102"
  },
  {
      "nombre": "(",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": ")",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "{",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "=",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "==",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "===",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": ">=",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "<=",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "!=",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "!==",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": ";",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": ":",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "}",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": ".",
      "tipo": "simbolo",
      "codigo":"103"
  },
  {
      "nombre": "+",
      "tipo": "operador",
      "codigo":"104"
  },
  {
      "nombre": "-",
      "tipo": "operador",
      "codigo":"104"
  },
  {
      "nombre": "*",
      "tipo": "operador",
      "codigo":"104"
  },
  {
      "nombre": "/",
      "tipo": "operador",
      "codigo":"104"
  },
  {
      "nombre": "%",
      "tipo": "operador",
      "codigo":"104"
  }
  
];

function borrar(){

  document.querySelectorAll("table tbody tr").forEach(function(e){e.remove()})
  document.getElementById("inputcodigo").value="";
  $('#ocultarLexico').css('display', 'none');
  $('#ocularSintactico').css('display', 'none');


}

function analizar(){



if (document.getElementById("inputcodigo").value==""){
  alert ("Por favor ingresar instruccion(es)");
  return;
}

const str = document.getElementById("inputcodigo").value;



if (str.includes(';')==false){
  alert ("Por favor debe separar cada instruccion mediante simbolo ( ; )");
  return;
}
  
document.querySelectorAll("table tbody tr").forEach(function(e){e.remove()})

    $('#ocultarLexico').css('display', 'block');
    $('#ocularSintactico').css('display', 'block');


let Analizadorlexico =[];

Analizadorlexico = document.getElementById("inputcodigo").value;


let tokens = [];

      /* en cada linea separamos los simbolos*/
      Analizadorlexico = Analizadorlexico.trim();
      Analizadorlexico = Analizadorlexico.replaceAll(';',' ; ');
      Analizadorlexico = Analizadorlexico.replaceAll('+',' + ');
      Analizadorlexico = Analizadorlexico.replaceAll('(',' ( ');
      Analizadorlexico = Analizadorlexico.replaceAll(')',' ) ');
      Analizadorlexico = Analizadorlexico.replaceAll('>=',' >= ');
      Analizadorlexico = Analizadorlexico.replaceAll('<=',' <= ');
      Analizadorlexico = Analizadorlexico.replaceAll('=',' = ');
      Analizadorlexico = Analizadorlexico.replaceAll(' =  = ',' == ');
      Analizadorlexico = Analizadorlexico.replaceAll(' ==  = ',' === ');
      
      Analizadorlexico = Analizadorlexico.replaceAll('<',' < ');
      Analizadorlexico = Analizadorlexico.replaceAll('>',' > ');
      Analizadorlexico = Analizadorlexico.replaceAll(';',' ; ');
      Analizadorlexico = Analizadorlexico.replaceAll('::',' :: ');
      Analizadorlexico = Analizadorlexico.replaceAll(',',' , ');

      

    
    /* separamos cada linea por los espacios */
    let listaDePalabras = [];
     listaDePalabras = Analizadorlexico.split(/\s+/gm);
     var index = listaDePalabras.indexOf("");
        if (index > -1) {
          listaDePalabras.splice(index, 1);
      }


  n=0;
  nointeracciones=[];
  t=1;
  let resultado="";
  let resultadoCodigo="";

  
  

  const $cuerpoTabla = document.querySelector("#cuerpoTabla");
    
  listaDePalabras.forEach(listaDePalabra => {
    if (listaDePalabra!=undefined && listaDePalabra!=''){
    const $tr = document.createElement("tr");
   
    let $vuelta = document.createElement("td");
    $vuelta.textContent = t; 
    $tr.appendChild($vuelta);
    t++;
    
    let $nombreconjunto1 = document.createElement("td");
    $nombreconjunto1.textContent = listaDePalabras[n];
    $tr.appendChild($nombreconjunto1);
    

    lexemas.forEach(object =>{
      //console.log(object.nombre);
      //console.log(listaDePalabras[n]);

    if(object.nombre == listaDePalabras[n].toUpperCase()){
        resultado= object.tipo;
        resultadoCodigo= object.codigo;
        //alert (resultado);
    }
    });

    if(parseInt(listaDePalabras[n])>1 ||parseInt(listaDePalabras[n])<=1){
        resultado= 'numero';
        resultadoCodigo= '102';
        //alert (resultado);
    };

    if(resultado==''){
        resultado= 'identificador';
        resultadoCodigo= '101';
        //alert (resultado);
    };

    let $selectorOperacion = document.createElement("td");
    $selectorOperacion.textContent = resultado;
    $tr.appendChild($selectorOperacion);
   
   

    let $nombreconjunto2 = document.createElement("td");
    $nombreconjunto2.textContent = resultadoCodigo;
    $tr.appendChild($nombreconjunto2);
    n++;
    $cuerpoTabla.appendChild($tr);}

    resultado="";
    resultadoCodigo="";

    });




    let sintaxis = [];
    sintaxis = Analizadorlexico.split(/(;)+/gm);
     var index = sintaxis.indexOf('');
        if (index > -1) {
          sintaxis.splice(index, 1);
      }

    
      


  n=0;
  nointeracciones=[];
  t=1;
  let resultado2="";
  mensaje=0;

    const $cuerpoTabla2 = document.querySelector("#cuerpoTabla2");
    
    sintaxis.forEach(arreglosintaxis => {

      resultado2="Sintaxis NO reconocida";

      sintaxis[n] = sintaxis[n].replaceAll('\n',' ');
      sintaxis[n] = sintaxis[n].replaceAll(/\s+/gm,' ');
      sintaxis[n] = sintaxis[n].trim();

      if (sintaxis[n]!=undefined && sintaxis[n]!='' && sintaxis[n]!=';' && sintaxis[n]!="" && sintaxis[n]!='  ') {
      const $tr = document.createElement("tr");
     
      let $vuelta = document.createElement("td");
      $vuelta.textContent = t; 
      $tr.appendChild($vuelta);
      t++;
      
      let $nombreconjunto1 = document.createElement("td");
      $nombreconjunto1.textContent = sintaxis[n];
      $tr.appendChild($nombreconjunto1);
      
      
      


const regex = /((GRANT (SELECT|UPDATE|DELETE|INSERT) ON OBJECT :: ([A-Za-z0-9._$-]+) [(] ([A-Za-z0-9._$-]+) [)]( TO )([A-Za-z0-9._$-]+))$|(GRANT EXECUTE ON ([A-Za-z0-9._$-]+)( TO )([A-Za-z0-9._$-]+))$|(REVOKE READ_WRITE ON ([A-Za-z0-9._$-]+))$|(GRANT (SELECT|UPDATE|DELETE|INSERT) ON TABLE ([A-Za-z0-9._$-]+)( TO )([A-Za-z0-9._$-]+)(( , )([A-Za-z0-9._$-]+))*( WITH GRANT OPTION)*( AT ALL LOCATIONS)*)$|(GRANT (SELECT|UPDATE|DELETE|INSERT) ON ([A-Za-z0-9._$-]+) TO ([A-Za-z0-9._$-]+)([A-Za-z0-9._$-]+)(( , )([A-Za-z0-9._$-]+))* (WITH GRANT OPTION)*)$|(GRANT ALL PRIVILEGES TO ([A-Za-z0-9._$-]+)( WITH GRANT OPTION)*)$|(GRANT ON TABLE TO ([A-Za-z0-9._$-]+)( WITH GRANT OPTION)*)|(GRANT (((READ)|WRITE)|(READ , WRITE)) ON VARIABLE ([A-Za-z0-9._$-]+) TO ([A-Za-z0-9._$-]+))$|(REVOKE (SELECT|UPDATE|DELETE|INSERT|INDEX) ON( TABLE)* ([A-Za-z0-9._$-]+) FROM( USER| GROUP)* ([A-Za-z0-9._$-]+)( BY ALL)*)$|(REVOKE ALL PRIVILEGES ON ([A-Za-z0-9._$-]+) FROM ([A-Za-z0-9._$-]+))$|(REVOKE ALL ON ([A-Za-z0-9._$-]+) FROM USER ([A-Za-z0-9._$-]+)((( , ))USER ([A-Za-z0-9._$-]+))*( , GROUP ([A-Za-z0-9._$-]+))*))$/gismd



const str1 = sintaxis[n];
let m;





while ((m = regex.exec(str1)) !== null) {
    // This is necessary to avoid infinite loops with zero-width matches
    if (m.index === regex.lastIndex) {
        regex.lastIndex++;
    }
    
    // The result can be accessed through the `m`-variable.
    m.forEach((match, groupIndex) => {
        console.log(`Found match, group ${groupIndex}: ${match}`);

        if (match!=undefined){
            resultado2='sintaxis correcta'
            mensaje++;
        }
    });
}


      let $selectorOperacion = document.createElement("td");
      $selectorOperacion.textContent =resultado2;
      $tr.appendChild($selectorOperacion);
  
      
      $cuerpoTabla2.appendChild($tr);

      
        //console.log(sintaxis);
    }
      n++;
  
      });







// mensaje






}
</script>


               

<br>
<div id="ocularSintactico" name="ocularSintactico" style="display: none;"> 
<div class="container_Sintactico">
  <h4>Analizador Sintactico</h4>
  <div id="aSintactico" class="table-wrapper-scroll-y my-custom-scrollbar table-responsive ">
    <table class="table table-bordered table-striped table align-middle">
      <thead class="thead-dark" style="position: sticky;top: 0" >
        <tr>
          <th class="h6 col-2" scope="col">Instruccion</th>
          <th class="h6 col-6" scope="col">Sintaxis</th>
          <th class="h6 col-4"scope="col">Manejador Error</th>
        </tr>
      </thead>
      <tbody id="cuerpoTabla2"></tbody>
    </table>
  </div>
</div>
</div>




</body>
</html>